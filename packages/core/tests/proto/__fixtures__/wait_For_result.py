from datetime import datetime
from interfaces.errors.communication_error import DeviceCommunicationError
from interfaces.errors.app_error import DeviceAppError

# Constant date for mocking Date.now() in tests
constant_date = datetime(2023, 3, 7, 9, 43, 48, 755000)

# Wait for result test fixtures
fixtures = {
    "invalid_args": [
        {
            "sequence_number": 123423,
        }
    ],
    "valid": [
        {
            "name": "Seq: 16",
            "output": bytes([
                98, 110, 1, 88, 234, 189, 103, 120, 176, 24, 231, 183, 92, 134, 213, 11,
            ]),
            "applet_id": 12,
            "sequence_number": 16,
            "packets": [
                bytes([
                    85, 85, 193, 89, 0, 1, 0, 1, 0, 16, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 1,
                ])
            ],
            "output_packets": [
                [
                    bytes([
                        85, 85, 46, 177, 0, 1, 0, 1, 0, 16, 6, 1, 0, 240, 33, 24, 0, 4, 0,
                        16, 10, 2, 8, 12, 98, 110, 1, 88, 234, 189, 103, 120, 176, 24, 231,
                        183, 92, 134, 213, 11,
                    ])
                ]
            ],
            "status_packets": [
                [
                    bytes([
                        85, 85, 131, 161, 0, 1, 0, 1, 255, 255, 4, 1, 0, 17, 254, 14, 0, 10,
                        0, 0, 16, 2, 24, 1, 32, 16, 40, 12, 48, 4,
                    ])
                ],
                [
                    bytes([
                        85, 85, 147, 128, 0, 1, 0, 1, 255, 255, 4, 1, 0, 17, 254, 14, 0, 10,
                        0, 0, 16, 2, 24, 1, 32, 16, 40, 12, 48, 5,
                    ])
                ],
                [
                    bytes([
                        85, 85, 163, 227, 0, 1, 0, 1, 255, 255, 4, 1, 0, 17, 254, 14, 0, 10,
                        0, 0, 16, 2, 24, 1, 32, 16, 40, 12, 48, 6,
                    ])
                ]
            ],
            "status_list": [
                {
                    "device_idle_state": 2,
                    "device_waiting_on": 0,
                    "abort_disabled": True,
                    "current_cmd_seq": 16,
                    "cmd_state": 12,
                    "flow_status": 4,
                },
                {
                    "device_idle_state": 2,
                    "device_waiting_on": 0,
                    "abort_disabled": True,
                    "current_cmd_seq": 16,
                    "cmd_state": 12,
                    "flow_status": 5,
                },
                {
                    "device_idle_state": 2,
                    "device_waiting_on": 0,
                    "abort_disabled": True,
                    "current_cmd_seq": 16,
                    "cmd_state": 12,
                    "flow_status": 6,
                }
            ]
        },
        {
            "name": "Seq: 212",
            "output": bytes([
                211, 95, 208, 246, 195, 233, 125, 125, 142, 158, 16, 49, 166, 64, 71,
                223, 4, 39, 173, 223, 87, 209, 132, 137, 44, 179, 100, 203, 81, 235,
                220, 61, 62, 106, 88, 81, 29, 188, 137, 250, 150, 12, 134, 7, 119, 192,
                45, 158, 57, 44, 81, 36, 73, 204, 79, 75, 101, 95, 157, 180, 177, 87,
                23, 142, 108, 93, 18, 185, 58, 91, 184, 25, 87, 192, 249, 160, 189, 105,
                130, 218, 154, 74, 90, 194, 245, 71, 135, 86, 119, 50, 236, 167, 96,
                202, 83, 159, 181, 98, 249, 98, 16, 216, 144, 191, 214, 50, 191, 47,
                103, 40, 168, 247, 104, 151, 174, 66, 209, 232, 44, 220, 106, 230, 73,
                173, 233, 137, 41, 152, 156, 158, 199, 236, 106, 209, 247, 180, 11, 121,
                166, 192, 244, 5, 195, 18, 58, 236, 199, 197, 52, 253, 112, 160, 231,
                221, 6, 28, 23, 126, 132, 183, 118, 224, 165, 46, 10, 93, 113, 156, 83,
                11, 83, 145, 228, 195, 36, 199, 238, 189, 234, 21, 12, 157, 19, 127,
                207, 47, 43, 250, 19, 210, 89, 44, 116, 120, 118, 36, 199, 250, 250, 49,
                212, 90, 182, 122, 1, 206, 182, 188, 180, 140, 3, 72, 78, 40, 188, 235,
                112, 51, 0, 7, 170, 110, 35, 93, 70, 0, 125, 96, 81, 97, 134, 132, 242,
                83, 126, 178, 177, 226, 128, 174, 58, 190, 248, 76, 114, 215, 123, 212,
                35, 245, 116, 31, 169, 152, 200, 83, 42, 217, 224, 209, 101, 193, 3,
                237, 139, 234, 48, 247, 97, 94, 131,
            ]),
            "sequence_number": 212,
            "applet_id": 124,
            "packets": [
                bytes([
                    85, 85, 43, 132, 0, 1, 0, 1, 0, 212, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 1,
                ]),
                bytes([
                    85, 85, 27, 231, 0, 1, 0, 1, 0, 212, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 2,
                ]),
                bytes([
                    85, 85, 11, 198, 0, 1, 0, 1, 0, 212, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 3,
                ]),
                bytes([
                    85, 85, 123, 33, 0, 1, 0, 1, 0, 212, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 4,
                ]),
                bytes([
                    85, 85, 107, 0, 0, 1, 0, 1, 0, 212, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 5,
                ]),
                bytes([
                    85, 85, 91, 99, 0, 1, 0, 1, 0, 212, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 6,
                ])
            ],
            "output_packets": [
                [
                    bytes([
                        85, 85, 149, 158, 0, 1, 0, 6, 0, 212, 6, 1, 0, 240, 35, 48, 0, 4, 1,
                        15, 10, 2, 8, 124, 211, 95, 208, 246, 195, 233, 125, 125, 142, 158,
                        16, 49, 166, 64, 71, 223, 4, 39, 173, 223, 87, 209, 132, 137, 44,
                        179, 100, 203, 81, 235, 220, 61, 62, 106, 88, 81, 29, 188, 137, 250,
                    ])
                ],
                [
                    bytes([
                        85, 85, 11, 146, 0, 2, 0, 6, 0, 212, 6, 1, 0, 240, 35, 48, 150, 12,
                        134, 7, 119, 192, 45, 158, 57, 44, 81, 36, 73, 204, 79, 75, 101, 95,
                        157, 180, 177, 87, 23, 142, 108, 93, 18, 185, 58, 91, 184, 25, 87,
                        192, 249, 160, 189, 105, 130, 218, 154, 74, 90, 194, 245, 71, 135,
                        86,
                    ])
                ],
                [
                    bytes([
                        85, 85, 124, 221, 0, 3, 0, 6, 0, 212, 6, 1, 0, 240, 35, 48, 119, 50,
                        236, 167, 96, 202, 83, 159, 181, 98, 249, 98, 16, 216, 144, 191,
                        214, 50, 191, 47, 103, 40, 168, 247, 104, 151, 174, 66, 209, 232,
                        44, 220, 106, 230, 73, 173, 233, 137, 41, 152, 156, 158, 199, 236,
                        106, 209, 247, 180,
                    ])
                ],
                [
                    bytes([
                        85, 85, 36, 42, 0, 4, 0, 6, 0, 212, 6, 1, 0, 240, 35, 48, 11, 121,
                        166, 192, 244, 5, 195, 18, 58, 236, 199, 197, 52, 253, 112, 160,
                        231, 221, 6, 28, 23, 126, 132, 183, 118, 224, 165, 46, 10, 93, 113,
                        156, 83, 11, 83, 145, 228, 195, 36, 199, 238, 189, 234, 21, 12, 157,
                        19, 127,
                    ])
                ],
                [
                    bytes([
                        85, 85, 39, 8, 0, 5, 0, 6, 0, 212, 6, 1, 0, 240, 35, 48, 207, 47,
                        43, 250, 19, 210, 89, 44, 116, 120, 118, 36, 199, 250, 250, 49, 212,
                        90, 182, 122, 1, 206, 182, 188, 180, 140, 3, 72, 78, 40, 188, 235,
                        112, 51, 0, 7, 170, 110, 35, 93, 70, 0, 125, 96, 81, 97, 134, 132,
                    ])
                ],
                [
                    bytes([
                        85, 85, 231, 215, 0, 6, 0, 6, 0, 212, 6, 1, 0, 240, 35, 39, 242, 83,
                        126, 178, 177, 226, 128, 174, 58, 190, 248, 76, 114, 215, 123, 212,
                        35, 245, 116, 31, 169, 152, 200, 83, 42, 217, 224, 209, 101, 193, 3,
                        237, 139, 234, 48, 247, 97, 94, 131,
                    ])
                ]
            ],
            "status_packets": [
                [
                    bytes([
                        85, 85, 215, 81, 0, 1, 0, 1, 255, 255, 4, 1, 0, 17, 254, 15, 0, 11,
                        0, 0, 16, 2, 24, 1, 32, 212, 1, 40, 124, 48, 4,
                    ])
                ],
                [
                    bytes([
                        85, 85, 6, 252, 0, 1, 0, 1, 255, 255, 4, 1, 0, 17, 254, 15, 0, 11,
                        0, 0, 16, 2, 24, 1, 32, 212, 1, 40, 124, 48, 9,
                    ])
                ],
                [
                    bytes([
                        85, 85, 165, 166, 0, 1, 0, 1, 255, 255, 4, 1, 0, 17, 254, 15, 0, 11,
                        0, 0, 16, 2, 24, 1, 32, 212, 1, 40, 124, 48, 18,
                    ])
                ]
            ],
            "status_list": [
                {
                    "device_idle_state": 2,
                    "device_waiting_on": 0,
                    "abort_disabled": True,
                    "current_cmd_seq": 212,
                    "cmd_state": 124,
                    "flow_status": 4,
                },
                {
                    "device_idle_state": 2,
                    "device_waiting_on": 0,
                    "abort_disabled": True,
                    "current_cmd_seq": 212,
                    "cmd_state": 124,
                    "flow_status": 9,
                },
                {
                    "device_idle_state": 2,
                    "device_waiting_on": 0,
                    "abort_disabled": True,
                    "current_cmd_seq": 212,
                    "cmd_state": 124,
                    "flow_status": 18,
                }
            ]
        }
    ],
    "error": [
        # Invalid crc
        {
            "name": "Invalid CRC",
            "applet_id": 12,
            "sequence_number": 16,
            "packets": [
                bytes([
                    85, 85, 193, 89, 0, 1, 0, 1, 0, 16, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 1,
                ])
            ],
            "output_packets": [
                [
                    bytes([
                        85, 85, 100, 192, 0, 1, 0, 1, 0, 16, 6, 1, 0, 18, 139, 24, 0, 0, 0,
                        20, 0, 0, 0, 12, 98, 110, 1, 88, 234, 189, 103, 120, 176, 24, 231,
                        183, 92, 134, 213, 11,
                    ])
                ]
            ],
            "status_packets": [],
            "status_list": [],
            "error_instance": DeviceCommunicationError
        },
        {
            "name": "Invalid sequenceNumber",
            "applet_id": 215,
            "sequence_number": 215,
            "packets": [
                bytes([
                    85, 85, 228, 33, 0, 1, 0, 1, 0, 215, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 1,
                ])
            ],
            "output_packets": [
                [
                    bytes([
                        85, 85, 178, 91, 0, 1, 0, 1, 0, 200, 4, 1, 0, 18, 146, 11, 0, 0, 0,
                        7, 3, 0, 0, 200, 1, 0, 164,
                    ])
                ]
            ],
            "status_packets": [],
            "status_list": [],
            "error_instance": DeviceAppError
        },
        {
            "name": "Invalid appletId",
            "applet_id": 215,
            "sequence_number": 215,
            "packets": [
                bytes([
                    85, 85, 228, 33, 0, 1, 0, 1, 0, 215, 3, 1, 0, 17, 254, 6, 0, 0, 0, 2,
                    0, 1,
                ])
            ],
            "output_packets": [
                [
                    bytes([
                        85, 85, 224, 254, 0, 1, 0, 1, 0, 215, 6, 1, 0, 17, 254, 26, 0, 22,
                        0, 0, 10, 20, 8, 12, 18, 16, 98, 110, 1, 88, 234, 189, 103, 120,
                        176, 24, 231, 183, 92, 134, 213, 11,
                    ])
                ]
            ],
            "status_packets": [],
            "status_list": [],
            "error_instance": DeviceAppError
        }
    ]
}
